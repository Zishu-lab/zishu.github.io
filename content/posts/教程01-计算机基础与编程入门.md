---
title: "二维码扫描系统教程（一）：计算机基础与编程入门"
date: 2026-02-11
draft: false
tags: ["Python", "编程入门", "教程", "二维码"]
categories: ["技术教程"]
description: "零基础学习编程的第一课，从计算机本质讲起，详细介绍Python编程基础，包括变量、数据类型、条件语句、循环、函数等核心概念。"
---

# 二维码扫描系统 - 零基础完整教程

## 第一部分：计算机基础与编程入门

---

## 第一章：什么是计算机程序？

### 1.1 计算机的本质

在深入编程之前，我们需要先理解计算机是什么。

**计算机的本质：**
- 计算机本质上是一个**只会做简单计算的机器**
- 它能做什么：加减乘除、比较大小、存储数据、读取数据
- 它不能做什么：理解模糊指令、自主思考、产生创意

**类比理解：**

想象你有一个超级计算器，这个计算器：
- 计算速度极快（每秒几十亿次）
- 记忆力很好（能存几百万本书）
- 但它很笨，只能听懂非常精确的指令

**例子：**

```
你对人说话："帮我买点水果"
人类理解：去水果店，买苹果、香蕉等

你对电脑说："帮我买点水果"
电脑反应：？？？什么叫"水果"？什么叫"买"？
         需要精确指令：打开浏览器→输入网址→点击商品...
```

### 1.2 什么是编程？

**编程的定义：**
- 编程 = 用计算机能听懂的语言，给它写指令
- 程序 = 一系列精确指令的集合
- 程序员 = 把人类想法翻译成计算机指令的人

**生活类比：**

```
编程就像写菜谱：

菜谱名称：西红柿炒鸡蛋
----------------------------
步骤1：准备材料
  - 西红柿 2个
  - 鸡蛋 3个
  - 盐 适量

步骤2：西红柿切块
  - 洗净西红柿
  - 切成块状

步骤3：打散鸡蛋
  - 打入碗中
  - 搅拌均匀

...（后续步骤）

计算机程序也是这样：
- 材料 = 数据
- 步骤 = 代码
- 执行 = 运行程序
```

### 1.3 计算机如何存储信息？

#### 1.3.1 二进制基础

**为什么是二进制？**
- 计算机内部只有"开"和"关"两种状态
- 开 = 1，关 = 0
- 所有的信息最终都变成0和1的组合

**类比理解：**

```
电灯开关：
  开关向上 = 灯亮 = 1
  开关向下 = 灯灭 = 0

计算机就是数十亿个小开关：
  01001101 = 字母 'A'
  00100000 = 空格 ' '
  01100001 = 字母 'a'
```

**位和字节：**
- 位（bit）：一个0或1
- 字节（byte）：8个位 = 8个0/1组合

```
1字节 = 00000000 到 11111111
     = 0 到 255
     = 可以表示256种不同的东西

常见单位：
  1 KB = 1024 字节（约一千字）
  1 MB = 1024 KB（约一百万字）
  1 GB = 1024 MB
```

#### 1.3.2 文字如何存储？

**ASCII码：**
- 计算机需要知道哪个数字代表哪个字母
- ASCII码就是一种"数字-字母"对照表

```
数字  →  字母
--------------
65   →  'A'
66   →  'B'
67   →  'C'
...
97   →  'a'
98   →  'b'
99   →  'c'
...
32   →  ' ' (空格)
48   →  '0'
49   →  '1'
```

**例子：**
```
"Hi" 在计算机中：
H = 72 = 01001000
i = 105 = 01101001

存储为：01001000 01101001
```

#### 1.3.3 图像如何存储？

**数字图像原理：**

想象你把一张照片切成无数个小格子：
- 每个小格子叫"像素"
- 每个像素有一个颜色值
- 计算机存储所有像素的颜色值

**彩色图像（RGB）：**
- R = Red（红）
- G = Green（绿）
- B = Blue（蓝）
- 每个颜色用一个数字表示亮度（0-255）

```
纯红色：  RGB(255, 0, 0)
纯绿色：  RGB(0, 255, 0)
纯蓝色：  RGB(0, 0, 255)
白色：   RGB(255, 255, 255)
黑色：   RGB(0, 0, 0)
灰色：   RGB(128, 128, 128)
```

**图像尺寸：**
- 640×480 的图像 = 640列 × 480行 = 307,200个像素
- 每个像素3个字节（RGB）= 约1MB数据

### 1.4 计算机的组成部分

**硬件（看得见摸得着的）：**

```
┌─────────────────────────────────┐
│       计算机硬件组成           │
├─────────────────────────────────┤
│ CPU（中央处理器）              │
│  - 计算机的大脑                │
│  - 执行所有计算和指令          │
│  - 速度单位：GHz（每秒几十亿） │
├─────────────────────────────────┤
│ 内存（RAM）                   │
│  - 临时工作区                 │
│  - 断电后数据丢失             │
│  - 单位：GB                   │
├─────────────────────────────────┤
│ 硬盘（存储）                  │
│  - 永久存储区                 │
│  - 断电后数据保留             │
│  - 单位：GB、TB               │
├─────────────────────────────────┤
│ 摄像头                        │
│  - 捕获图像                   │
│  - 本项目的输入设备           │
└─────────────────────────────────┘
```

**软件（看不见的程序）：**
- 操作系统（Linux/Windows/Mac）
- 应用程序（浏览器、游戏）
- 编程语言解释器（Python）

---

## 第二章：Python编程基础入门

### 2.1 为什么选择Python？

**Python的特点：**

```
优点：
✓ 语法简单，接近英语
✓ 学习曲线平缓
✓ 功能强大，应用广泛
✓ 免费开源
✓ 社区活跃，资源丰富

缺点：
✗ 运行速度比C/C++慢
✗ 移动端开发较弱
```

**Python的应用领域：**
- 网站开发（YouTube、豆瓣）
- 数据分析（ pandas、numpy）
- 人工智能（TensorFlow、PyTorch）
- 自动化脚本
- 本项目：图像处理+Web服务

### 2.2 Python安装与环境配置

#### 2.2.1 安装Python

**Windows系统：**
1. 访问 python.org
2. 下载最新版Python安装包
3. 运行安装程序（勾选"Add to PATH"）

**Linux系统：**
```bash
# 大多数Linux已预装Python
python3 --version  # 检查版本

# 如果没有，使用包管理器安装
sudo apt install python3  # Ubuntu/Debian
sudo yum install python3  # CentOS/RHEL
```

**Mac系统：**
```bash
# 使用Homebrew安装
brew install python3
```

#### 2.2.2 验证安装

打开终端/命令行，输入：
```bash
python3 --version
# 应该显示类似：Python 3.12.0
```

### 2.3 第一个Python程序

#### 2.3.1 Hello World

**代码：**
```python
print("你好，世界！")
```

**讲解：**
- `print()` 是Python内置函数
- 括号里的内容会被输出到屏幕
- 引号表示这是文本（字符串）

**运行方式：**

方式1：交互式
```bash
$ python3
>>> print("你好，世界！")
你好，世界！
>>>
```

方式2：脚本文件
```bash
# 创建文件 hello.py
# 写入代码后运行
$ python3 hello.py
你好，世界！
```

### 2.4 变量与数据类型

#### 2.4.1 什么是变量？

**变量的概念：**
- 变量是存储数据的"盒子"
- 每个盒子有个名字（变量名）
- 盒子里可以放不同类型的数据

**类比理解：**
```
变量 = 有标签的盒子

┌─────────────┐
│ 名字: 年龄  │
│ 内容: 18    │
└─────────────┘

┌─────────────┐
│ 名字: 名字  │
│ 内容: "小明"│
└─────────────┘
```

**变量命名规则：**
```
✓ 正确的命名：
  - age（小写字母）
  - user_name（下划线分隔）
  - _private（下划线开头）
  - price2（可以包含数字）

✗ 错误的命名：
  - 2price（不能以数字开头）
  - user-name（不能用减号）
  - class（不能用保留字）
  - 用户名（不能用中文变量名）
```

#### 2.4.2 基本数据类型

**类型1：整数（int）**
```python
# 整数是没有小数部分的数字
年龄 = 18
数量 = 100
温度 = -5

print(年龄)  # 输出：18
print(type(年龄))  # 输出：<class 'int'>
```

**类型2：浮点数（float）**
```python
# 浮点数有小数部分
价格 = 19.99
身高 = 1.75
pi = 3.14159

print(价格)  # 输出：19.99
print(type(价格))  # 输出：<class 'float'>
```

**类型3：字符串（str）**
```python
# 字符串是文本，用引号包围
名字 = "小明"
消息 = 'Hello World'
空字符串 = ""

print(名字)  # 输出：小明
print(type(名字))  # 输出：<class 'str'>
```

**字符串操作：**
```python
# 拼接
问候 = "你好" + " " + "世界"
print(问候)  # 输出：你好 世界

# 重复
图案 = "*-" * 5
print(图案)  # 输出：*-*-*-*-*-

# 长度
text = "Python"
print(len(text))  # 输出：6
```

**类型4：布尔值（bool）**
```python
# 布尔值只有两个值：True 或 False
是学生 = True
已成年 = False
有工作 = True

print(是学生)  # 输出：True
print(type(是学生))  # 输出：<class 'bool'>
```

**类型5：列表（list）**
```python
# 列表是多个值的有序集合
水果 = ["苹果", "香蕉", "橙子"]
数字 = [1, 2, 3, 4, 5]
混合 = ["文本", 123, True]

print(水果[0])  # 输出：苹果（第一个，索引从0开始）
print(水果[1])  # 输出：香蕉（第二个）
print(水果[-1])  # 输出：橙子（最后一个）
```

**列表操作：**
```python
# 创建列表
购物清单 = []

# 添加元素
购物清单.append("牛奶")
购物清单.append("面包")
print(购物清单)  # ['牛奶', '面包']

# 获取长度
print(len(购物清单))  # 2

# 删除元素
购物清单.remove("面包")
print(购物清单)  # ['牛奶']

# 列表切片
数字 = [0, 1, 2, 3, 4, 5]
print(数字[1:4])  # [1, 2, 3]（从索引1到3）
print(数字[:3])   # [0, 1, 2]（从头到索引2）
print(数字[3:])   # [3, 4, 5]（从索引3到尾）
```

### 2.5 运算符

#### 2.5.1 算术运算符

```python
# 加法
result = 10 + 5
print(result)  # 15

# 减法
result = 10 - 5
print(result)  # 5

# 乘法
result = 10 * 5
print(result)  # 50

# 除法（结果是小数）
result = 10 / 3
print(result)  # 3.333...

# 整除（只保留整数部分）
result = 10 // 3
print(result)  # 3

# 取余数（除法后的余数）
result = 10 % 3
print(result)  # 1（10除以3商3余1）

# 幂运算（x的y次方）
result = 2 ** 3
print(result)  # 8（2的3次方）
```

#### 2.5.2 比较运算符

```python
# 等于
print(5 == 5)  # True
print(5 == 3)  # False

# 不等于
print(5 != 3)  # True

# 大于
print(5 > 3)  # True

# 小于
print(5 < 3)  # False

# 大于等于
print(5 >= 5)  # True

# 小于等于
print(5 <= 3)  # False
```

#### 2.5.3 逻辑运算符

```python
# 与（and）：两个条件都为True，结果才为True
print(True and True)   # True
print(True and False)  # False
print(False and False) # False

# 例子
年龄 = 20
有票 = True
print(年龄 >= 18 and 有票)  # True（可以进电影院）

# 或（or）：至少一个条件为True，结果就为True
print(True or True)   # True
print(True or False)  # True
print(False or False) # False

# 例子
是周末 = True
是节假日 = False
print(是周末 or 是节假日)  # True（不用上班）

# 非（not）：取反
print(not True)   # False
print(not False)  # True
```

### 2.6 条件语句

#### 2.6.1 if语句

**基本语法：**
```python
if 条件:
    执行的代码
```

**例子：**
```python
年龄 = 18

if 年龄 >= 18:
    print("你已经成年了")

# 输出：你已经成年了
```

#### 2.6.2 if-else语句

**基本语法：**
```python
if 条件:
    条件为True时执行
else:
    条件为False时执行
```

**例子：**
```python
年龄 = 16

if 年龄 >= 18:
    print("你可以考驾照")
else:
    print("你还未满18岁，不能考驾照")

# 输出：你还未满18岁，不能考驾照
```

#### 2.6.3 if-elif-else语句

**基本语法：**
```python
if 条件1:
    条件1为True时执行
elif 条件2:
    条件2为True时执行
else:
    以上条件都不满足时执行
```

**例子：**
```python
分数 = 85

if 分数 >= 90:
    print("优秀")
elif 分数 >= 80:
    print("良好")
elif 分数 >= 60:
    print("及格")
else:
    print("不及格")

# 输出：良好
```

#### 2.6.4 嵌套条件

```python
年龄 = 25
有票 = True

if 年龄 >= 18:
    if 有票:
        print("可以进入")
    else:
        print("请先买票")
else:
    print("未成年人禁止入内")

# 输出：可以进入
```

### 2.7 循环语句

#### 2.7.1 for循环

**基本语法：**
```python
for 变量 in 序列:
    重复执行的代码
```

**例子1：遍历列表**
```python
水果 = ["苹果", "香蕉", "橙子"]

for 水果 in 水果:
    print("我喜欢吃" + 水果)

# 输出：
# 我喜欢吃苹果
# 我喜欢吃香蕉
# 我喜欢吃橙子
```

**例子2：range函数**
```python
# range(5) 生成 0, 1, 2, 3, 4
for i in range(5):
    print(i)

# 输出：
# 0
# 1
# 2
# 3
# 4

# range(1, 6) 生成 1, 2, 3, 4, 5
for i in range(1, 6):
    print(i)

# 输出：1, 2, 3, 4, 5
```

**例子3：九九乘法表**
```python
for i in range(1, 10):
    for j in range(1, 10):
        print(f"{i}×{j}={i*j}", end="\t")
    print()  # 换行
```

#### 2.7.2 while循环

**基本语法：**
```python
while 条件:
    条件为True时重复执行
```

**例子：倒计时**
```python
count = 5

while count > 0:
    print(count)
    count = count - 1  # 或写成 count -= 1

print("发射！")

# 输出：
# 5
# 4
# 3
# 2
# 1
# 发射！
```

**注意：避免无限循环**
```python
# 危险！会永远运行
count = 0
while count < 10:
    print(count)
    # 忘记增加count，永远都是0<10

# 正确做法
count = 0
while count < 10:
    print(count)
    count += 1  # 每次加1
```

#### 2.7.3 循环控制

**break：跳出循环**
```python
for i in range(10):
    if i == 5:
        break  # 遇到5就停止
    print(i)

# 输出：0, 1, 2, 3, 4
```

**continue：跳过本次**
```python
for i in range(5):
    if i == 2:
        continue  # 跳过2
    print(i)

# 输出：0, 1, 3, 4
```

### 2.8 函数

#### 2.8.1 什么是函数？

**函数的概念：**
- 函数是一段可重复使用的代码块
- 给代码块起个名字，以后用名字调用它
- 可以传入参数，可以返回结果

**类比理解：**
```
函数 = 一台自动贩卖机

输入（参数）：硬币 + 商品编号
处理（函数体）：识别商品、出货
输出（返回值）：商品
```

#### 2.8.2 定义函数

**基本语法：**
```python
def 函数名(参数1, 参数2, ...):
    函数体
    return 返回值
```

**例子1：简单函数**
```python
def 问候():
    print("你好！")

# 调用函数
问候()  # 输出：你好！
问候()  # 输出：你好！
```

**例子2：带参数的函数**
```python
def 问候某人(名字):
    print("你好，" + 名字 + "！")

问候某人("小明")  # 输出：你好，小明！
问候某人("小红")  # 输出：你好，小红！
```

**例子3：带返回值的函数**
```python
def 计算面积(长, 宽):
    面积 = 长 * 宽
    return 面积

# 使用返回值
result = 计算面积(5, 3)
print("面积是：" + str(result))  # 面积是：15

# 直接在表达式中使用
print("面积是：" + str(计算面积(4, 2)))  # 面积是：8
```

**例子4：默认参数**
```python
def 问候(名字, 问候语="你好"):
    print(问候语 + "，" + 名字)

问候("小明")              # 你好，小明
问候("小明", "早上好")    # 早上好，小明
```

#### 2.8.3 变量作用域

```python
# 全局变量
全局变量 = "我是全局的"

def 函数():
    # 局部变量
    局部变量 = "我是局部的"
    print(全局变量)  # 可以访问
    print(局部变量)

函数()
print(全局变量)  # 可以访问
print(局部变量)  # 错误！无法访问局部变量
```

### 2.9 字符串格式化

**方法1：使用+号**
```python
名字 = "小明"
年龄 = 18
消息 = "我叫" + 名字 + "，今年" + str(年龄) + "岁"
print(消息)
```

**方法2：使用f-string（推荐）**
```python
名字 = "小明"
年龄 = 18
消息 = f"我叫{名字}，今年{年龄}岁"
print(消息)  # 我叫小明，今年18岁

# 可以在{}中进行计算
a = 10
b = 20
print(f"{a} + {b} = {a + b}")  # 10 + 20 = 30

# 可以格式化数字
pi = 3.14159
print(f"π约等于{pi:.2f}")  # π约等于3.14（保留2位小数）
```

### 2.10 文件操作

#### 2.10.1 读取文件

```python
# 方法1：一次性读取全部
文件 = open("test.txt", "r", encoding="utf-8")
内容 = 文件.read()
print(内容)
文件.close()

# 方法2：逐行读取
文件 = open("test.txt", "r", encoding="utf-8")
for 行 in 文件:
    print(行.strip())  # strip()去掉行末的换行符
文件.close()

# 方法3：使用with语句（推荐，自动关闭文件）
with open("test.txt", "r", encoding="utf-8") as 文件:
    内容 = 文件.read()
    print(内容)
```

#### 2.10.2 写入文件

```python
# 写入文本
with open("output.txt", "w", encoding="utf-8") as 文件:
    文件.write("第一行\n")
    文件.write("第二行\n")

# 追加内容
with open("output.txt", "a", encoding="utf-8") as 文件:
    文件.write("这是追加的内容\n")
```

### 2.11 异常处理

**为什么需要异常处理？**
- 程序运行时可能出错（文件不存在、除以0等）
- 如果不处理，程序会崩溃
- 异常处理让程序优雅地处理错误

**基本语法：**
```python
try:
    可能出错的代码
except 错误类型:
    出错时执行的代码
```

**例子：**
```python
# 例子1：除以零
try:
    result = 10 / 0
except ZeroDivisionError:
    print("不能除以零！")

# 例子2：文件不存在
try:
    文件 = open("不存在的文件.txt", "r")
except FileNotFoundError:
    print("文件不存在！")

# 例子3：捕获所有异常
try:
    # 一些可能出错的代码
    result = 10 / 0
except Exception as e:
    print(f"出错了：{e}")
```

### 2.12 练习题

**练习1：温度转换**
```python
# 华氏温度转摄氏温度
# 公式：C = (F - 32) * 5/9

def 华氏转摄氏(华氏温度):
    摄氏温度 = (华氏温度 - 32) * 5 / 9
    return 摄氏温度

print(华氏转摄氏(32))   # 0.0（水的冰点）
print(华氏转摄氏(212))  # 100.0（水的沸点）
```

**练习2：判断闰年**
```python
# 闰年规则：
# 1. 能被4整除但不能被100整除，或
# 2. 能被400整除

def 是闰年(年份):
    if (年份 % 4 == 0 and 年份 % 100 != 0) or (年份 % 400 == 0):
        return True
    else:
        return False

print(是闰年(2020))  # True
print(是闰年(2021))  # False
print(是闰年(2000))  # True（能被400整除）
print(是闰年(1900))  # False（能被100但不能被400整除）
```

**练习3：计算阶乘**
```python
# n! = 1 × 2 × 3 × ... × n
# 5! = 1 × 2 × 3 × 4 × 5 = 120

def 阶乘(n):
    result = 1
    for i in range(1, n + 1):
        result = result * i
    return result

print(阶乘(5))  # 120
print(阶乘(10))  # 3628800
```

---

## 第三章：Python进阶与模块

### 3.1 模块的概念

**什么是模块？**
- 模块是一个包含Python定义和语句的文件
- 模块可以包含函数、类、变量
- 使用模块可以组织代码，方便复用

**类比理解：**
```
模块 = 工具箱
  - 螺丝刀模块：各种螺丝刀
  - 扳手模块：各种扳手
  - 锤子模块：各种锤子

需要什么工具就从对应模块拿
```

### 3.2 导入模块

**方法1：导入整个模块**
```python
import math

# 使用模块中的函数
print(math.sqrt(16))  # 4.0（平方根）
print(math.pi)        # 3.14159...（圆周率）
print(math.sin(0))     # 0.0（正弦）
```

**方法2：导入模块中的特定函数**
```python
from math import sqrt, pi

print(sqrt(16))  # 4.0（不需要写math.sqrt）
print(pi)        # 3.14159...
```

**方法3：给模块起别名**
```python
import math as m

print(m.sqrt(16))  # 4.0
print(m.pi)        # 3.14159...
```

### 3.3 常用内置模块

#### 3.3.1 random模块（随机数）

```python
import random

# 生成随机整数（0-9）
print(random.randint(0, 9))

# 生成随机浮点数（0-1）
print(random.random())

# 从列表中随机选择
水果 = ["苹果", "香蕉", "橙子"]
print(random.choice(水果))

# 打乱列表
random.shuffle(水果)
print(水果)
```

#### 3.3.2 time模块（时间）

```python
import time

# 获取当前时间戳
print(time.time())  # 1703123456.789

# 暂停程序执行
print("开始")
time.sleep(2)  # 暂停2秒
print("结束")

# 获取当前时间
当前时间 = time.localtime()
print(当前时间.tm_year)   # 年
print(当前时间.tm_mon)    # 月
print(当前时间.tm_mday)   # 日

# 格式化时间输出
print(time.strftime("%Y-%m-%d %H:%M:%S"))  # 2023-12-21 15:30:45
```

#### 3.3.3 datetime模块（日期时间）

```python
from datetime import datetime, date, timedelta

# 获取当前日期时间
now = datetime.now()
print(now)  # 2023-12-21 15:30:45.123456

# 只获取日期
today = date.today()
print(today)  # 2023-12-21

# 创建特定日期
生日 = date(2000, 6, 15)
print(生日)  # 2000-06-15

# 计算时间差
delta = timedelta(days=7)
未来 = today + delta
print(未来)  # 2023-12-28

# 计算日期差
日期1 = date(2023, 12, 1)
日期2 = date(2023, 12, 25)
差 = 日期2 - 日期1
print(差.days)  # 24
```

#### 3.3.4 os模块（操作系统）

```python
import os

# 获取当前工作目录
print(os.getcwd())

# 列出目录内容
print(os.listdir("."))

# 创建目录
os.makedirs("新文件夹", exist_ok=True)

# 删除文件
os.remove("file.txt")

# 检查文件/目录是否存在
print(os.path.exists("test.txt"))  # True/False
```

### 3.4 类与对象（面向对象编程）

#### 3.4.1 什么是面向对象？

**概念理解：**

```
面向过程 = 关注"怎么做"
面向对象 = 关注"谁来做"

例子：洗衣服

面向过程的思维：
1. 打开水龙头
2. 放水到盆里
3. 放衣服
4. 加洗衣粉
5. 搓洗
6. 漂清
7. 晾干

面向对象的思维：
洗衣机.洗衣服()

洗衣机封装了所有细节，
你只需要按按钮（调用方法）
```

#### 3.4.2 类和对象

**基本概念：**
- 类（Class）：对象的"模板"或"设计图"
- 对象（Object）：根据类创建的"实例"

**类比理解：**
```
类 = 月饼模具
对象 = 用模具做出来的月饼

一个模具（类）可以做出很多月饼（对象），
每个月饼都有相同的形状，但可能有不同的馅料。
```

**定义类：**
```python
class 狗:
    # 类属性（所有实例共享）
    物种 = "犬科"

    # 初始化方法（创建对象时调用）
    def __init__(self, 名字, 年龄):
        # 实例属性（每个对象独立）
        self.名字 = 名字
        self.年龄 = 年龄

    # 实例方法
    def 叫:
        print(f"{self.名字}说：汪汪！")

    def 自我介绍:
        print(f"我是{self.名字}，今年{self.年龄}岁")

# 创建对象（实例化）
狗1 = 狗("旺财", 3)
狗2 = 狗("来福", 5)

# 调用方法
狗1.叫()        # 旺财说：汪汪！
狗2.自我介绍()  # 我是来福，今年5岁

# 访问属性
print(狗1.名字)  # 旺财
print(狗1.物种)  # 犬科
```

#### 3.4.3 类的继承

**继承的概念：**
- 子类可以继承父类的属性和方法
- 子类可以添加自己的属性和方法
- 子类可以重写父类的方法

```python
# 父类（基类）
class 动物:
    def __init__(self, 名字):
        self.名字 = 名字

    def 吃:
        print(f"{self.名字}在吃东西")

    def 睡:
        print(f"{self.名字}在睡觉")

# 子类（继承自动物）
class 狗(动物):
    def 叫:
        print(f"{self.名字}说：汪汪！")

class 猫(动物):
    def 叫:
        print(f"{self.名字}说：喵喵！")

# 使用
狗 = 狗("旺财")
猫 = 猫("咪咪")

狗.吃()  # 继承自动物类
狗.叫()  # 狗类自己的方法
猫.吃()  # 继承自动物类
猫.叫()  # 猫类自己的方法
```

---

## 第四章：本项目中的类详解

### 4.1 QRScannerServer类结构

```python
class QRScannerServer:
    """二维码扫描服务器类"""

    def __init__(self, width, height, fps, camera_id, ...):
        """初始化：设置各种参数"""
        pass

    def initialize_camera(self):
        """初始化摄像头"""
        pass

    def estimate_qr_position(self, qr_points):
        """估算二维码位置（距离、角度）"""
        pass

    def decode_qr_codes(self, frame):
        """识别和解码二维码"""
        pass

    def draw_detections(self, frame, detections):
        """在图像上绘制检测结果"""
        pass

    def capture_frames(self):
        """持续捕获摄像头画面"""
        pass

    def get_frame_generator(self):
        """生成视频流"""
        pass

    def get_stats(self):
        """获取统计信息"""
        pass

    def start(self):
        """启动扫描"""
        pass

    def stop(self):
        """停止扫描"""
        pass
```

### 4.2 逐行解析核心代码

#### 4.2.1 初始化方法

```python
def __init__(self, width=640, height=480, fps=30, camera_id=0, ...):
    """
    初始化QR扫描服务器

    参数说明：
    - width: 视频宽度（像素）
    - height: 视频高度（像素）
    - fps: 每秒帧数
    - camera_id: 摄像头设备编号
    - qr_size: 二维码真实尺寸（米）
    """

    # 保存参数到实例变量
    self.width = width      # 宽度
    self.height = height    # 高度
    self.fps = fps          # 帧率
    self.camera_id = camera_id  # 摄像头ID
    self.qr_size = qr_size  # 二维码尺寸

    # 初始化其他属性
    self.camera = None          # 摄像头对象（稍后初始化）
    self.is_running = False    # 是否正在运行

    # 当前帧（带锁保护）
    self.frame = None
    self.frame_lock = threading.Lock()

    # 检测历史记录（使用双端队列，最多保存N条）
    self.detection_history = deque(maxlen=100)
    self.detection_lock = threading.Lock()

    # 统计数据
    self.frame_count = 0        # 总帧数
    self.total_detections = 0    # 总检测次数

    # 相机内参（用于位置估算）
    self.focal_length = None     # 焦距
    self.cx = None               # 主点X坐标
    self.cy = None               # 主点Y坐标
```

**详细讲解：**

1. **默认参数：**
```python
def __init__(self, width=640, height=480, ...):
    # 如果调用时不传参数，使用默认值
扫描器 = QRScannerServer()  # 使用640x480
扫描器 = QRScannerServer(width=1280)  # 使用1280x480
```

2. **self关键字：**
```python
self.width = width  # 把参数width保存到对象的width属性

# 为什么需要self？
# 因为一个类可以创建多个对象，
# self表示"当前这个对象"
```

3. **线程锁：**
```python
self.frame_lock = threading.Lock()

# 为什么需要锁？
# 如果一个线程在读取frame，另一个线程在修改frame
# 可能会读到一半新数据一半旧数据（数据不一致）
# 锁确保同一时间只有一个线程访问数据
```

4. **双端队列：**
```python
from collections import deque

# 创建最多保存100条的队列
history = deque(maxlen=100)

# 添加元素
history.append(item1)

# 超过100条时，最旧的自动删除
history.append(item101)  # item1自动消失
```

#### 4.2.2 相机初始化

```python
def initialize_camera(self):
    """初始化摄像头"""

    try:
        # 创建摄像头对象
        self.camera = cv2.VideoCapture(self.camera_id)

        # 检查是否成功打开
        if not self.camera.isOpened():
            raise Exception(f"无法打开摄像头 {self.camera_id}")

        # 设置摄像头参数
        self.camera.set(cv2.CAP_PROP_FRAME_WIDTH, self.width)
        self.camera.set(cv2.CAP_PROP_FRAME_HEIGHT, self.height)
        self.camera.set(cv2.CAP_PROP_FPS, self.fps)

        # 获取实际参数（可能和设置的不一样）
        实际宽度 = int(self.camera.get(cv2.CAP_PROP_FRAME_WIDTH))
        实际高度 = int(self.camera.get(cv2.CAP_PROP_FRAME_HEIGHT))
        实际帧率 = self.camera.get(cv2.CAP_PROP_FPS)

        # 估算相机内参
        self.focal_length = 实际宽度 * 1.2  # 经验公式
        self.cx = 实际宽度 / 2.0           # 图像中心X
        self.cy = 实际高度 / 2.0           # 图像中心Y

        return True

    except Exception as e:
        print(f"初始化摄像头失败: {e}")
        return False
```

**详细讲解：**

1. **VideoCapture对象：**
```python
# cv2.VideoCapture() 创建一个摄像头连接
# 参数可以是：
# - 数字：摄像头编号（0, 1, 2...）
# - 字符串：视频文件路径
# - 网络流地址：rtsp://...

camera = cv2.VideoCapture(0)

# 读取一帧
ret, frame = camera.read()
# ret: 是否成功（True/False）
# frame: 图像数据（numpy数组）
```

2. **摄像头属性：**
```python
# 常用属性：
CAP_PROP_FRAME_WIDTH   # 宽度
CAP_PROP_FRAME_HEIGHT  # 高度
CAP_PROP_FPS           # 帧率
CAP_PROP_BRIGHTNESS    # 亮度
CAP_PROP_CONTRAST      # 对比度
CAP_PROP_SATURATION    # 饱和度
```

#### 4.2.3 位置估算算法

```python
def estimate_qr_position(self, qr_points):
    """
    估算二维码位置

    参数: qr_points - 二维码四个角点坐标 [(x1,y1), (x2,y2), (x3,y3), (x4,y4)]
    返回: 包含距离、角度、3D坐标的字典
    """

    # 计算二维码中心点
    center_x = sum(p[0] for p in qr_points) / 4.0
    center_y = sum(p[1] for p in qr_points) / 4.0

    # 计算二维码在图像中的大小
    p0 = np.array(qr_points[0])
    p1 = np.array(qr_points[1])
    p2 = np.array(qr_points[2])
    p3 = np.array(qr_points[3])

    # 计算边长
    宽度像素 = np.linalg.norm(p0 - p1)  # 点0到点1的距离
    高度像素 = np.linalg.norm(p1 - p2)  # 点1到点2的距离
    平均像素 = (宽度像素 + 高度像素) / 2.0

    # 使用相似三角形计算距离
    距离 = (self.qr_size * self.focal_length) / 平均像素

    # 计算角度
    dx = center_x - self.cx  # X方向偏移
    dy = center_y - self.cy  # Y方向偏移

    水平角 = np.arctan2(dx, self.focal_length)  # 弧度
    垂直角 = np.arctan2(dy, self.focal_length)  # 弧度

    # 转换为角度
    水平角度数 = np.degrees(水平角)
    垂直角度数 = np.degrees(垂直角)

    # 估算3D坐标
    x = 距离 * np.tan(水平角)
    y = 距离 * np.tan(垂直角)
    z = 距离

    return {
        'distance': 距离,
        'horizontal_angle': 水平角度数,
        'vertical_angle': 垂直角度数,
        'x': x, 'y': y, 'z': z,
        'center_x': center_x,
        'center_y': center_y,
        'qr_size_pixel': 平均像素
    }
```

**算法原理图解：**

```
相似三角形原理：

实际世界                    图像平面
      ╱│                         ╱│
     ╱ │                       ╱  │
    ╱  │ h (二维码真实大小)    ╱   │
   ╱   │ 0.05m               ╱    │
  ╱─────┘                    ╱─────┘
   d    f                     f     s
  (距离)  (焦距)              (焦距) (像素大小)

  d / f = h / s
  d = f × h / s

  其中：
  - d: 距离（我们要求的）
  - f: 焦距（已知的相机参数）
  - h: 二维码真实大小（已知的，如0.05m）
  - s: 二维码在图像中的像素大小（测量得到的）
```

---

## 本章小结

### 学习检查清单

**基础概念：**
- [ ] 理解二进制和字节
- [ ] 理解变量和数据类型
- [ ] 掌握if条件语句
- [ ] 掌握for和while循环
- [ ] 理解函数的定义和调用
- [ ] 了解类和对象的基本概念

**实践能力：**
- [ ] 能编写简单的Python程序
- [ ] 能使用列表、字典等数据结构
- [ ] 能处理文件读写
- [ ] 能处理异常情况

**下章预告：**
- Web开发基础（HTML/CSS/JavaScript）
- Flask框架详解
- 图像处理基础（OpenCV入门）
- 二维码识别算法详解

---

*第一部分完成*

## 继续学习请阅读：
[教程02：Web开发与前端技术](/posts/教程02-web开发与前端技术/)
