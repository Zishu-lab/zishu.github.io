<!-- Background Animation Script -->
<script>
(function() {
  'use strict';
  const canvas = document.createElement('canvas');
  canvas.id = 'bg-canvas';
  canvas.style.position = 'fixed';
  canvas.style.top = '0';
  canvas.style.left = '0';
  canvas.style.width = '100vw';
  canvas.style.height = '100vh';
  canvas.style.zIndex = '-1';
  canvas.style.pointerEvents = 'none';
  document.body.appendChild(canvas);

  const ctx = canvas.getContext('2d');
  if (!ctx) return;

  let animationId = null;
  let particles = [];
  let width = window.innerWidth;
  let height = window.innerHeight;
  let isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');

  function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
  }

  function initParticles() {
    const count = Math.floor((width * height) / 20000);
    particles = [];
    for (let i = 0; i < count; i++) {
      const isSpecial = Math.random() > 0.85;
      particles.push({
        x: Math.random() * width,
        y: Math.random() * height,
        radius: isSpecial ? Math.random() * 3 + 1.5 : Math.random() * 2 + 0.5,
        speed: isSpecial ? Math.random() * 0.5 + 0.2 : Math.random() * 0.5 + 0.1,
        wind: (Math.random() - 0.5) * 0.5,
        opacity: Math.random() * 0.5 + 0.1,
        rotation: Math.random() * Math.PI * 2,
        rotationSpeed: (Math.random() - 0.5) * 0.02,
        isSpecial: isSpecial
      });
    }
  }

  function drawPetal(x, y, radius, rotation, opacity) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rotation);
    ctx.beginPath();
    ctx.ellipse(0, 0, radius * 2, radius, 0, 0, Math.PI * 2);
    const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, radius * 2);
    gradient.addColorStop(0, `rgba(255, 220, 230, ${opacity})`);
    gradient.addColorStop(1, `rgba(255, 180, 200, ${opacity * 0.5})`);
    ctx.fillStyle = gradient;
    ctx.fill();
    ctx.restore();
  }

  function drawStar(x, y, radius, rotation, opacity, isGold) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rotation);
    const spikes = 4;
    const outerRadius = radius * 1.5;
    const innerRadius = radius * 0.7;
    ctx.beginPath();
    for (let i = 0; i < spikes * 2; i++) {
      const r = i % 2 === 0 ? outerRadius : innerRadius;
      const angle = (i * Math.PI) / spikes;
      const px = Math.cos(angle) * r;
      const py = Math.sin(angle) * r;
      i === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
    }
    ctx.closePath();
    if (isGold) {
      ctx.fillStyle = `rgba(255, 230, 150, ${opacity})`;
      ctx.shadowColor = 'rgba(255, 215, 100, 0.5)';
      ctx.shadowBlur = 5;
    } else {
      ctx.fillStyle = `rgba(255, 255, 255, ${opacity})`;
    }
    ctx.fill();
    ctx.restore();
  }

  function drawCircle(x, y, radius, opacity, isDark) {
    ctx.beginPath();
    ctx.arc(x, y, radius, 0, Math.PI * 2);
    if (isDark) {
      ctx.fillStyle = `rgba(255, 255, 255, ${opacity * 0.8})`;
    } else {
      ctx.fillStyle = `rgba(255, 200, 210, ${opacity * 0.8})`;
    }
    ctx.fill();
  }

  function animate() {
    if (document.hidden || reducedMotion.matches) {
      animationId = requestAnimationFrame(animate);
      return;
    }
    ctx.clearRect(0, 0, width, height);
    particles.forEach(p => {
      p.y += p.speed;
      p.x += p.wind;
      p.rotation += p.rotationSpeed;
      if (p.y > height) { p.y = -10; p.x = Math.random() * width; }
      if (p.x > width) p.x = 0;
      if (p.x < 0) p.x = width;
      if (isDarkMode) {
        if (p.isSpecial) { drawStar(p.x, p.y, p.radius, p.rotation, p.opacity, true); }
        else { drawCircle(p.x, p.y, p.radius, p.opacity, true); }
      } else {
        if (p.isSpecial) { drawPetal(p.x, p.y, p.radius, p.rotation, p.opacity); }
        else { drawCircle(p.x, p.y, p.radius, p.opacity, false); }
      }
    });
    animationId = requestAnimationFrame(animate);
  }

  function start() {
    if (!animationId) { resize(); initParticles(); animate(); }
  }

  window.addEventListener('resize', () => { resize(); initParticles(); });
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => { isDarkMode = e.matches; });
  start();
})();
</script>
